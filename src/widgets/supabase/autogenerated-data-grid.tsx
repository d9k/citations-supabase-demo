import { JsonView } from '/~/shared/ui/json-view.tsx';
import { WithQueryKeyUniqueSuffix } from '/~/shared/lib/react/query/key.ts';
import { useQuery } from '@tanstack/react-query';
import { useSupabase } from '/~/shared/providers/supabase/client.ts';
import { DbTable } from '/~/shared/api/supabase/json-schema.types.ts';

export type SupabaseAutogeneratedDataGridProps = {
  tableName: string;
  tableSchema: DbTable;
} & WithQueryKeyUniqueSuffix;

export const SupabaseAutogeneratedDataGrid = (
  { tableName, tableSchema, queryKeyUniqueSuffix }:
    SupabaseAutogeneratedDataGridProps,
) => {
  console.debug(
    'SupabaseAutogeneratedDataGrid: queryKeyUniqueSuffix:',
    queryKeyUniqueSuffix,
  );

  const supabase = useSupabase();

  const { data, error } = useQuery({
    queryKey: ['SupabaseAutogeneratedDataGrid' + queryKeyUniqueSuffix],
    queryFn: () => supabase?.from(tableName).select('*'),
  });

  return <JsonView data={{ ...data, tableSchema }} />;
};
